---
title: MySQL事务
categories:
  - 数据库
tags: MySQL
abbrlink: f91535f
date: 2022-10-23 23:30:31
---



# MySQL事务(InnoDB)



## 事务的概念

事务就是一个不可分割的操作单元，其中的多个操作被认为是一个整体，要么全部执行成功，要么执行失败。



## 事务的特性

通常来说，我们一般认为事务具有四个特性。

### 隔离性 

> 不同的事务之间，是互相隔离的，不会互相影响。
>
> 通过锁和`MVCC`来实现。



### 持久性

> 一旦事务执行完成，那么对事务中影响到的数据的变化，是永久的，一般是指持久化到磁盘上或者日志文件中。
>
> 通过`redo log`来实现



### 原子性

> 一个事务中的多个操作，被认为是一个整体，不可再分割，只要其中一个操作执行失败，就认为整个事务执行失败了。
>
> 基于`undo log`。



### 一致性

> 事务执行完成后，对于数据的变化，要求要一致。举例来说，转帐，A向B转账，B向C转账，在两个操作结束之后，数据结果要求一致。
>
> 通过回滚，以及恢复，和在并发环境下的隔离做到一致性，也就是基于上述的 `redo log`、`undo log`、`MVCC`等一起实现。



## 并发事务可能产生的问题

### 数据丢失

> 多个事务选择同一行数据进行更新，最后一个提交的事务所做的修改覆盖了前面其他事务提交的更新。

### 脏读

> 事务A可以读到事务B未`commit`的数据



### 不可重复读

> 同一事务的其他实例在该实例处理其间可能会有新的`commit`，同一`select`可能返回不同结果, 查询结果的值有变化



### 幻读

>用户读取某一范围的数据行时，另一个事务又在该范围内插入了新行，当用户再读取该范围的数据行时，会发现有新的“幻影” 行， 查询结果行数变化。



## 事务隔离级别

事务隔离级别是一个标准，在不同的事务隔离级别下，对于事务特性的保证是有差异的，随之也会产生一些问题。



### 读未提交

不同的事务之间，会读到其他事务未提交的数据。保证了**持久性**、**原子性**，但是**没有保证隔离性及一致性**，会出现以下问题：

- 脏读
- 幻读
- 不可重复读

### 读已提交

不同事务之间，只会读取到其他事务提交的数据，解决了脏读的问题，但依然存在

- 幻读
- 不可重复读

### 可重复读（MySQL默认的隔离级别）

解决了不可重复读的问题，保证了同一事务中多次读取的数据是一样的。会存在

- 幻读

### 串行化

不同的事务之间，不再具备并发能力，只能一个个排着队执行，解决了上述的问题，但性能极差。



